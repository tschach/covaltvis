!function(){let e,t,a,n=!1,o={};const l={matrixChartTitle:(e,t)=>`${e}: COVID-19 7-Tage-Inzidenzwerte nach Altersgruppen, Stand: ${t}`};let i,r,c=0,d=[];const s=["total","A00-A04","A05-A14","A15-A34","A35-A59","A60-A79","A80+"],m=["Alle","0–4","5—14","15—34","35—59","60—79","80+"],u=["total","A00-05","A06-09","A10-14","A15-19","A20-29","A30-44","A45-59","A60-74","A75+"],h=["Alle","0–5","6—9","10—14","15–19","20—29","30—44","45—59","60—74","75+"],p={DEFAULT:{label:"Standard-Farbschema",ranges:[{min:0,max:5,color:"#f0f8ff"},{min:5,max:10,color:"#d9e2eb"},{min:10,max:15,color:"#c3ccd7"},{min:15,max:20,color:"#aeb7c3"},{min:20,max:35,color:"#99a2b0"},{min:35,max:50,color:"#868e9d"},{min:50,max:100,color:"#737a8a"},{min:100,max:150,color:"#606678"},{min:150,max:200,color:"#4f5366"},{min:200,max:300,color:"#3e4155"},{min:300,max:600,color:"#2e3044"},{min:600,max:1e3,color:"#2e2033"},{min:1e3,max:1500,color:"#2e1022"},{min:1500,max:2e3,color:"#2e0011"},{min:2e3,max:2500,color:"#2e0000"},{min:2500,max:3e3,color:"#5e0000"},{min:3e3,max:1/0,color:"#8e0000"}]},PURPLEGREENYELLOW:{label:"Lila-Grün-Gelb",ranges:[{min:0,max:5,color:"#441155"},{min:5,max:10,color:"#341264"},{min:10,max:15,color:"#1a1374"},{min:15,max:20,color:"#133283"},{min:20,max:35,color:"#136193"},{min:35,max:50,color:"#129ca2"},{min:50,max:100,color:"#10b282"},{min:100,max:150,color:"#0ec14f"},{min:150,max:200,color:"#0bd110"},{min:200,max:300,color:"#4de008"},{min:300,max:600,color:"#9ff004"},{min:600,max:1e3,color:"#aff024"},{min:1e3,max:1500,color:"#bff044"},{min:1500,max:2e3,color:"#cff064"},{min:2e3,max:2500,color:"#dff084"},{min:2500,max:3e3,color:"#eff0a4"},{min:3e3,max:1/0,color:"#fff0c4"}]},TEAL:{label:"Farbschema Türkis",ranges:[{min:0,max:5,color:"#6eeefa"},{min:5,max:35,color:"#63d4e2"},{min:35,max:50,color:"#58bbca"},{min:50,max:100,color:"#4da2b3"},{min:100,max:150,color:"#428b9c"},{min:150,max:200,color:"#387386"},{min:200,max:300,color:"#2d5d71"},{min:300,max:400,color:"#23475c"},{min:400,max:1/0,color:"#193348"}]},RKIHEATMAP:{label:"RKI-Heatmap",ranges:[{min:0,max:5,color:"#d0d1e6"},{min:5,max:10,color:"#a6bedb"},{min:10,max:15,color:"#7cacd1"},{min:15,max:20,color:"#a6c883"},{min:20,max:35,color:"#e5ef25"},{min:35,max:50,color:"#ffe600"},{min:50,max:100,color:"#ffbd00"},{min:100,max:150,color:"#ff8700"},{min:150,max:200,color:"#ff3c00"},{min:200,max:300,color:"#f40000"},{min:300,max:600,color:"#bf0000"},{min:600,max:1e3,color:"#bf0033"},{min:1e3,max:1500,color:"#bf0066"},{min:1500,max:2e3,color:"#bf0099"},{min:2e3,max:2500,color:"#bf00bb"},{min:2500,max:3e3,color:"#bf00cc"},{min:3e3,max:1/0,color:"#bf00ff"}]}};let f,g;const y={type:"matrix",data:{datasets:[{label:"",data:[],borderColor:"#000",borderWidth:function(e){return"total"===e.raw.y?{top:4,left:0,right:0,bottom:0}:0},backgroundColor:function(e){let t=f||"DEFAULT",a=e.dataset.data[e.dataIndex].v;var n=p[t].ranges[0].color;return p[t].ranges.forEach(e=>{a>e.min&&a<=e.max&&(n=e.color)}),n},height(e){const t=e.chart.chartArea;return t?(t.bottom-t.top)/s.length+1:0},width(e){const t=e.chart.chartArea;return t?(t.right-t.left)/c+1:0}}]},options:{animation:{duration:0},layout:{padding:15},plugins:{title:{display:!1},tooltip:{displayColors:!1,callbacks:{title:()=>"",label(e){const t=e.dataset.data[e.dataIndex];return[`${I(t.x)}`,`Inzidenz: ${t.v.toString().replace(".",",")}`,`Fälle heute: ${t.d.toString().replace(".",",")}`,`Fälle letzte 7 Tage: ${t.w.toString().replace(".",",")}`]}}},legend:{display:!1}},scales:{x:{type:"time",offset:!0,time:{unit:"week",round:"day",isoWeekday:1,displayFormats:{week:"DD.MM.YY",day:"DD.MM.YY"}},ticks:{font:{size:12,family:"Monospace"},color:"#333",maxRotation:90,minRotation:90,autoSkip:!0,padding:0},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}},"y-1":{display:!0,type:"category",position:"left",title:{color:"#333",display:!0,text:"Alter in Jahren",font:{size:14,family:"Monospace"}},offset:!0,labels:s,ticks:{display:!0,callback:function(e,t,a){return m[e]},font:{size:12,family:"Monospace"},color:"#333",padding:5,autoSkip:!1},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}},"y-2":{display:!0,type:"category",position:"right",offset:!0,labels:s,ticks:{display:!0,callback:function(e,t,a){return m[e]},font:{size:12,family:"Monospace"},color:"#333",padding:5,autoSkip:!1},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}}}}},x={type:"matrix",data:{datasets:[{label:"",data:[],borderColor:"#000",borderWidth:function(e){return"total"===e.raw.y?{top:4,left:0,right:0,bottom:0}:0},backgroundColor:function(e){let t=f||"DEFAULT",a=e.dataset.data[e.dataIndex].v;var n=p[t].ranges[0].color;return p[t].ranges.forEach(e=>{a>e.min&&a<=e.max&&(n=e.color)}),n},height(e){const t=e.chart.chartArea;return t?(t.bottom-t.top)/u.length+1:0},width(e){const t=e.chart.chartArea;return t?(t.right-t.left)/c+1:0}}]},options:{animation:{duration:0},layout:{padding:15},plugins:{title:{display:!1},tooltip:{displayColors:!1,callbacks:{title:()=>"",label(e){const t=e.dataset.data[e.dataIndex];return[`${t.x} (${moment(t.first).format("D.M.YY")}–${moment(t.last).format("D.M.YY")})`,`Inzidenz: ${t.v.toString().replace(".",",")}`,`neue Fälle: ${t.c}`,`Altersgruppe: ${h[u.indexOf(t.y)]}`,`Bevölkerung: ${t.p}`]}}},legend:{display:!1}},scales:{x:{type:"category",offset:!0,title:{color:"#333",display:!0,text:"Kalenderwoche",font:{size:14,family:"Monospace"},padding:{top:5}},ticks:{font:{size:12,family:"Monospace"},color:"#333",maxRotation:90,minRotation:90,autoSkip:!0,beginAtZero:!0},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}},"y-1":{display:!0,type:"category",position:"left",title:{color:"#333",display:!0,text:"Alter in Jahren",font:{size:14,family:"Monospace"}},offset:!0,labels:u,ticks:{display:!0,callback:function(e,t,a){return h[e]},font:{size:12,family:"Monospace"},color:"#333",padding:5,autoSkip:!1},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}},"y-2":{display:!0,type:"category",position:"right",offset:!0,labels:u,ticks:{display:!0,callback:function(e,t,a){return h[e]},font:{size:12,family:"Monospace"},color:"#333",padding:5,autoSkip:!1},grid:{display:!1,drawBorder:!1,tickMarkLength:0},gridLines:{display:!1}}}}};function b(e){if(d=[],e)for(const[t,a]of Object.entries(e.target.options))a.selected&&a.value&&5===a.value.length&&d.push(a.value);else document.getElementById("landkreisSelect").dispatchEvent(new Event("change"))}function E(e){e?f=e.target.value:document.querySelectorAll("input[name=colorscheme]").forEach(e=>{e.checked&&e.dispatchEvent(new Event("change"))})}function k(){switch(f){case"PURPLEGREENYELLOW":return"3";case"RKIHEATMAP":return"2";default:return"1"}}function A(t){t?e="v2"===t.target.value:document.querySelectorAll("input[name=heatmapversion]").forEach(e=>{e.checked&&e.dispatchEvent(new Event("change"))}),e?(document.getElementById("btnradio1").checked=!0,document.getElementById("btnradio1").dispatchEvent(new Event("change")),document.getElementById("btnradio2").disabled=!0,document.getElementById("btnradio3").disabled=!0,document.getElementById("btnradio4").disabled=!0):(document.getElementById("btnradio2").disabled=!1,document.getElementById("btnradio3").disabled=!1,document.getElementById("btnradio4").disabled=!1)}function v(t){document.getElementById("legendContainer").innerHTML="";let a=document.createElement("div");a.setAttribute("class","d-xl-flex justify-content-between");let n=document.createElement("p");n.setAttribute("class","text-muted small"),n.innerText="Maus über / Finger auf eine Kachel für Details.",a.appendChild(n),(n=document.createElement("p")).setAttribute("class","text-muted small"),n.innerHTML=`URL für diese Ansicht: <a href="${$(t)}">${$(t)}</a>`,a.appendChild(n),document.getElementById("legendContainer").appendChild(a),(a=document.createElement("dl")).setAttribute("class","row text-muted"),a.innerHTML=e?'<dt class="col-xl-3">Farbschema</dt><dd class="col-xl-9">gemeldete COVID-19-Fälle in der Kalenderwoche pro 100.000 Personen in der Altersgruppe (7-Tage-Inzidenz). Inzidenzen der aktuellen Kalenderwoche sind niedriger und enthalten Unsicherheiten. Ab Mitte der Woche können Tendenzen sichtbar werden.</dd>':'<dt class="col-xl-3">Farbschema</dt><dd class="col-xl-9">gemeldete COVID-19-Fälle der letzten 7 Tage pro 100.000 Personen in der Altersgruppe (7-Tage-Inzidenz). Tage ohne Daten werden in der Kategorie „0–5“ dargestellt.</dd>',document.getElementById("legendContainer").appendChild(a);const o=document.createElement("ul");o.setAttribute("class","list-inline row"),p[f].ranges.forEach(e=>{const t=document.createElement("li");t.setAttribute("class","list-inline-item col-lg-2 col-md-3 col-sm-4 col-6");let a=`${0===e.min?"":">"}&#8201;${e.min}${isFinite(e.max)?"&#8239;&#8211;&#8201;"+e.max:""}`;t.innerHTML=`<span style="background-color:${e.color};height:16px;width:16px;margin-right:8px;display:inline-block"></span><span style="vertical-align:text-bottom">${a}</span>`,o.appendChild(t)}),document.getElementById("legendContainer").appendChild(o),(a=document.createElement("dl")).setAttribute("class","row text-muted"),a.innerHTML='<dt class="col-xl-3">X-Achse</dt><dd class="col-xl-9">zeitlicher Verlauf</dd><dt class="col-xl-3">Y-Achse</dt><dd class="col-xl-9">Altersgruppen und Gesamtbevölkerung, Stand: 31.12.2019.</dd>',document.getElementById("legendContainer").appendChild(a),(n=document.createElement("p")).setAttribute("class","text-muted");const l=document.createElement("a");e?l.setAttribute("href",`https://github.com/tschach/covaltvis/blob/main/data/v2/${t}v2.json`):l.setAttribute("href",`https://github.com/tschach/covaltvis/blob/main/data/${t}.json`),l.innerText="Datensatz auf Github",n.appendChild(l),document.getElementById("legendContainer").appendChild(n)}function w(e){if(e){g=e.target.value;let a=new Date;switch(g){case"oct2020":i="2020-10-01",y.options.scales.x.time.unit="week";break;case"jan2021":i="2021-01-01",y.options.scales.x.time.unit="week";break;case"last28d":a.setDate(a.getDate()-28),i=(t=a).getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2),y.options.scales.x.time.unit="day";break;default:i=null,y.options.scales.x.time.unit="week"}}else document.querySelectorAll("input[name=timeframe]").forEach(e=>{e.checked&&e.dispatchEvent(new Event("change"))});var t}function C(){switch(g){case"last28d":return"4";case"jan2021":return"3";case"oct2020":return"2";default:return"1"}}let I=function(e){return moment.isDate(e)||(e=new Date(e)),`${e.getDate()}. ${e.toLocaleString("de-DE",{month:"long"})} ${e.getFullYear()}`};function $(t){return!0===n?`http://127.0.0.1:8080/#${t}/${e?"v2":"v1"}/${C()}/${k()}`:`https://tschach.github.io/covaltvis/#${t}/${e?"v2":"v1"}/${C()}/${k()}`}function L(n,i){n=n||"2020-01-27",i=i||"2050-12-31",document.getElementById("canvasContainer").innerHTML="",c=0,d.forEach(r=>{let d=function(t){const a=`matrixChartCanvas${t}`,n=document.createElement("canvas");return n.setAttribute("id",a),e?n.setAttribute("style","width:100%;height:40vw;max-height:450px;min-height:300px;"):n.setAttribute("style","width:100%;height:33vw;max-height:400px;min-height:250px;"),document.getElementById("canvasContainer").appendChild(n),a}(r);a=document.getElementById(d).getContext("2d"),function(e,t){let a;return a=t?`data/v2/${e}v2.json`:`data/${e}.json`,axios.get(a)}(r,e).then(d=>{if(d.data){let m,h=[];if(e){for(const[e,t]of Object.entries(d.data.byWeek))t.incidenceByAgegroup&&(u.forEach(e=>{let a=0;a=t.incidenceByAgegroup[e],"total"!==e&&h.push({x:t.label,y:e,v:a,first:t.first,last:t.last,c:t.newCasesByAgegroup[e],p:d.data.populations[e]})}),h.push({x:t.label,y:"total",v:t.incidence,first:t.first,last:t.last,c:t.newCases,p:d.data.populations.total}));x.data.datasets[0].data=h,c=h.length/u.length;const e=document.createElement("h2");let n;e.setAttribute("class","offset-xl-1 col-xl-10 lead"),e.innerText=l.matrixChartTitle(o[r].name,I(new Date(d.data.lastCaseDate)));const i=document.getElementById("titleContainer");for(;n=i.firstChild;)n.remove();i.appendChild(e);try{t.destroy()}catch(e){}finally{t=new Chart(a,x)}v(r),document.getElementById("resultsContainer").scrollIntoView(!0)}else{for(const[e,t]of Object.entries(d.data))s.forEach(a=>{if(e>=n&&e<=i){let n=0;t.hasOwnProperty(`${a}_7day_cases_per_100k`)&&(n=t[`${a}_7day_cases_per_100k`]);let o="-";t.hasOwnProperty(`${a}_cases`)&&(o=t[`${a}_cases`]);let l="-";t.hasOwnProperty(`${a}_7day_cases`)&&(l=t[`${a}_7day_cases`]),h.push({x:e,y:a,v:n,d:o,w:l})}}),m=e;y.data.datasets[0].data=h,c=h.length/s.length;const e=document.createElement("h2");let u;e.setAttribute("class","offset-xl-1 col-xl-10 lead"),e.innerText=l.matrixChartTitle(o[r].name,I(new Date(m)));const p=document.getElementById("titleContainer");for(;u=p.firstChild;)u.remove();p.appendChild(e);try{t.destroy()}catch(e){}finally{t=new Chart(a,y)}v(r),document.getElementById("resultsContainer").scrollIntoView(!0)}}}).catch(function(e){console.log(e)}).then(function(){})})}document.getElementById("landkreisSelect").addEventListener("change",e=>b(e)),document.getElementById("updateChartsButton").addEventListener("click",function(){L(i,r)}),document.querySelectorAll("input[name=colorscheme]").forEach(e=>{e.addEventListener("change",e=>E(e))}),document.querySelectorAll("input[name=timeframe]").forEach(e=>{e.addEventListener("change",e=>w(e))}),document.querySelectorAll("input[name=heatmapversion]").forEach(e=>{e.addEventListener("change",e=>A(e))}),document.addEventListener("DOMContentLoaded",function(e){moment.locale("de-DE");let t=window.location.hash.substr(1);t&&(t=t.split("/")),t&&t[1]&&function(e){switch(e){case"v2":case"2":e="v2";break;default:e="v1"}document.querySelectorAll("input[name=heatmapversion]").forEach(t=>{t.value!==e||t.disabled?t.checked=!1:t.checked=!0})}(t[1]),t&&t[2]&&function(e){switch(e){case"last28d":case"4":e="last28d";break;case"jan2021":case"3":e="jan2021";break;case"oct2020":case"2":e="oct2020";break;default:e="all"}document.querySelectorAll("input[name=timeframe]").forEach(t=>{t.value!==e||t.disabled?t.checked=!1:t.checked=!0})}(t[2]),t&&t[3]&&function(e){switch(e){case"lgg":case"3":e="PURPLEGREENYELLOW";break;case"rki":case"2":e="RKIHEATMAP";break;default:e="DEFAULT"}document.querySelectorAll("input[name=colorscheme]").forEach(t=>{t.value!==e||t.disabled?t.checked=!1:t.checked=!0})}(t[3]),A(),E(),w(),axios.get("data/landkreise.json").then(e=>{if(e.data){o={},Object.keys(e.data).sort(function(t,a){return e.data[t].sorting>e.data[a].sorting?1:e.data[t].sorting<e.data[a].sorting?-1:0}).forEach(function(a){const n=e.data[a];let l=("0000"+a).slice(-5);o[l]=n;const i=document.createElement("option");i.setAttribute("value",l),i.innerText=`${n.name}`,i.selected=t&&t[0]===l,document.getElementById("landkreisSelect").appendChild(i)}),document.getElementById("landkreisSelect").disabled=!1,b(),!0===document.getElementById("landkreisSelect").validity.valid&&document.getElementById("updateChartsButton").dispatchEvent(new Event("click")),!0!==n||t[0]||(d=[Object.keys(o)[0]],L())}})})}();
